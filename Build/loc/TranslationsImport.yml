# ==================================================================================
# Pipeline for VsCodeExtension-Localization build definition
# Gets translated files from VSCodeExt and creates a PR for vscode-cpptools
#
# Triggered only by daily schedule
# ==================================================================================

resources:
  repositories:
  - repository: self
    clean: true
 - repository: VSCodeExt
    type: git

trigger: none

pool:
  vmImage: 'windows-latest'

steps:
- checkout: self
- checkout: git://CEINTL/VSCodeExt

#Because multi-check cannot span organizations (or between GitHub and Azure DevOps), manually clone the loc repo using a pat.
- task: CmdLine@2
  inputs:
    script: 'pushd && cd $(Build.SourcesDirectory) && git clone https://$(OneLocBuildPat)@ceapex.visualstudio.com/CEINTL/_git/VSCodeExt && popd'

- task: CmdLine@2
  inputs:
    script: 'pushd && cd $(Build.SourcesDirectory)/vscode-cpptools/Extension && node ./translations_auto_pr.js microsoft vscode-cpptools cpptools csigs $(csigsPat) $(Build.SourcesDirectory)/VSCodeExt && popd'
