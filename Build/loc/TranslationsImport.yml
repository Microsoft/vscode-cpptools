# ==================================================================================
# Pipeline for VsCodeExtension-Localization build definition
# Gets translated files from VSCodeExt and creates a PR for vscode-cpptools
#
# Triggered only by daily schedule
# ==================================================================================

resources:
  repositories:
  - repository: self
    clean: true
  - repository: github://microsoft/vscode-cpptools-api

trigger: none

pool:
  vmImage: 'windows-latest'

steps:
- checkout: self

# HACK: Clone vscode-cpptools-api as well, just to cause DevOps to give us a common parent directory we can manually clone the Loc repo into

- checkout:  github://microsoft/vscode-cpptools-api

- task: CmdLine@2
  inputs:
    script: 'pushd && cd $(Build.SourcesDirectory) && git clone https://$(OneLocBuildPat)@ceapex.visualstudio.com/CEINTL/_git/VSCodeExt && popd'

- task: CmdLine@2
  inputs:
    script: 'pushd && cd $(Build.SourcesDirectory)/vscode-cpptools/Extension && node ./translations_auto_pr.js microsoft vscode-cpptools cpptools csigs $(csigsPat) $(Build.SourcesDirectory)/VSCodeExt && popd'
